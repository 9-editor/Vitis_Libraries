

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Internals of Hash-Aggregate &mdash; XF Database Library 2.0 beta documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/xf-favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#trademark-notice">Trademark Notice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release Note</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usecase.html">Typical Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L1.html">L1 Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gqe_guide/L2.html">L2 GQE Kernel User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gqe_guide/L3.html">L3 GQE Overlay User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark Result</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../benchmark/tpc_h.html">TPC-H Queries with GQE</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">XF Database Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Internals of Hash-Aggregate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="internals-of-hash-aggregate">
<span id="guide-hash-aggregate"></span><h1>Internals of Hash-Aggregate<a class="headerlink" href="#internals-of-hash-aggregate" title="Permalink to this headline">Â¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>This document describes the structure and execution of Hash-Aggregate,
implemented as <span class="xref std std-ref">hashAggregate</span> function.</p>
<a class="reference internal image-reference" href="../../_images/hash_aggr.png"><img alt="Hash Aggregate Structure" class="align-center" src="../../_images/hash_aggr.png" style="width: 80%;" /></a>
<p>The Hash-Aggregate primitive is a PU which designed to utilize the advantage of high memory bandwidth in Xilinx FPGA.
Current design uses 1 input channel though which a pair of key and payload can be passed in each cycle.
When there is more than 1 input channel, Client could duplicate the PU and then again aggregate the result in the host side
to reach the goals.</p>
<p>There are Applicable conditions:</p>
<ol class="arabic simple">
<li>The width of hash space is configurable, HASHW can be configured no more than 12 (bit).
The design can handle no more than 1024(equal to 1&lt;&lt;(HASHW-2)) key distinct cases when the width of hash space is configed at 12 (bit).</li>
<li>The data width of combined key and payload is configurable, while sum of them cannot exceed 287 bits in current version.
Combined key means the combining key of the keys to be gourped-by.</li>
<li>There are four functions for calculating the payload. They are MAX, MIN ,SUM, COUNT,
Each one is represented by input parameter xf::database::AOP_MAX, xf::database::AOP_MIN, xf::database::AOP_SUM,
xf::database::AOP_COUNT.
These functions only support for integer types as ap_int&lt;n&gt;, int and so on.</li>
</ol>
<p>This PU performs Hash-Aggregate in four modules working simultaneously. For example, in a &lt;DATINW, DATOUTW, KINW, HASHW&gt;=&lt;32,32,236,12&gt;
design:</p>
<a class="reference internal image-reference" href="../../_images/hash_aggr_collision.png"><img alt="Hash Aggregate collision" class="align-center" src="../../_images/hash_aggr_collision.png" style="width: 80%;" /></a>
<ol class="arabic simple">
<li>hash_aggr_main: It takes a pair of Combined key and payload as input, calculate the hash address.
The keys which first hit their address (about 88%) are aggregated in this module and output to
hash_aggr_passmain.
Other keys are spilled to hash_aggr_spill</li>
<li>hash_aggr_spill: It takes a pair of Combined key and payload and relative hash value as input.
The keys which second hit their address (about 11%) are aggregated in this module and output
to hash_aggr_done.
Other keys are spilled to hash_aggr_done in the other streams.</li>
<li>hash_aggr_passmain: pass the result form the hash_aggr_main, so that the PU could dataflow.</li>
<li>hash_aggr_done: finally, the remaining keys (about 1%) are aggregated, and output all the
aggregate results.</li>
</ol>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">These Applicable conditions.</p>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">hashAggregate</span></code> primitve has only one port for key input and one port for payload input.
If your tables are joined by multiple key columns or has multiple columns as payload,
please use <a class="reference internal" href="../hw_api.html#cid-xf-database-combinecol"><span class="std std-ref">combineCol</span></a> to merge the column streams, and
use <a class="reference internal" href="../hw_api.html#cid-xf-database-splitcol"><span class="std std-ref">splitCol</span></a> to split the output to columns.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Xilinx Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>