

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2-Dimensional(Matrix) FFT L1 FPGA Module &mdash; XF FFT Library 1.0 beta documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/xf-favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="1-Dimensional (Line) FFT L1 FPGA Module" href="L1.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> XF FFT Library
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html#trademark-notice">Trademark Notice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Note</a></li>
</ul>
<p class="caption"><span class="caption-text">L1 User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="L1.html">1-Dimensional (Line) FFT L1 FPGA Module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2-Dimensional(Matrix) FFT L1 FPGA Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#block-level-interface">Block Level Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#d-fft-architecture">2-D FFT Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-data-types">Supported Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#l1-api-for-2-d-fft">L1 API for 2-D FFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#template-parameters">Template Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constraints-on-the-choice-of-template-parameters">Constraints on the Choice of Template Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#library-usage">Library Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fixed-point-2-d-fft-l1-module-usage">Fixed Point 2-D FFT L1 Module Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#floating-point-2-d-fft-l1-module-usage">Floating Point 2-D FFT L1 Module Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-example-test">Complete Example Test</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">XF FFT Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>2-Dimensional(Matrix) FFT L1 FPGA Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="dimensional-matrix-fft-l1-fpga-module">
<h1>2-Dimensional(Matrix) FFT L1 FPGA Module<a class="headerlink" href="#dimensional-matrix-fft-l1-fpga-module" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>XF FFT library provides a fully synthesizable 2-Dimensional Fourier Transform as L1 primitive.
This L1 primitive is designed to be easily transformed into L2 SDx kernel by adding memory adapters.
The L1 primitive is designed to have a very wide streaming interface as wide as device DDR memory
widths on boards like Xilinx U200, U250 and U280. Adding memory adapters requires a plugin at FFT input
side which has AXI interface for connection with DDR memory on one side and other sides needs to have
memory wide streaming interface to connect with 2-D FFT L1 primitive, second memory plugin is required
at the output side of the FFT which reads in stream of wide data and connects it to output AXI interface
for DDR memory connection.</p>
</div>
<div class="section" id="block-level-interface">
<h2>Block Level Interface<a class="headerlink" href="#block-level-interface" title="Permalink to this headline">¶</a></h2>
<p>The figure below shows the block level interface for 2-D FFT. Essentially it is a wide
streaming interface at the input and the output.</p>
<a class="reference internal image-reference" href="../_images/2-2d_fft_if.jpg"><img alt="doc tool flow" class="align-center" src="../_images/2-2d_fft_if.jpg" style="width: 50%;" /></a>
</div>
<div class="section" id="d-fft-architecture">
<h2>2-D FFT Architecture<a class="headerlink" href="#d-fft-architecture" title="Permalink to this headline">¶</a></h2>
<p>2-dimensional FFT is built on top of 1-D FFT. It deploys multiple 1-D FFT processors in parallel to
accelerate calculations. Potentially 2-D FFT can be accelerated by deploying multiple processor in
parallel to process multiple lines(rows/columns) of input data whose 1-D FFT calculation is independent of each other ( Data parallelism)
essentially decreasing the latency and also increasing the throughput. But 2-D FFT throughput can
also be increased by using task level pipeline where one set of 1-D FFT processors also called line
processors works row wise on 2-D input data and other set of line processors work column wise in a task level
pipeline on data produced by row processors as shown in the figure below. The row processors perform 1-D FFT row by row and column processors
perform transform on columns, row processors connect to column processors through a matrix transposer.
The following figure shows a simplified bock diagram which gives the 2-D FFT architecture used by XF FFT
Library. Essentially it is a big dataflow pipeline of blocks which perform data permutations and 1-D FFT transforms
working either row wise or column wise. Each of the 1-d FFT processor ( <a class="reference internal" href="L1.html#l1-fft-label"><span class="std std-ref">1-D XF FFT</span></a> ) is a Super
Sample Rate streaming processor. The 1D FFT processors used along the rows and columns are supposed to have same configuration which
is specified as described in <a class="reference internal" href="L1.html#float-fft-params-struct-label"><span class="std std-ref">Configuration Parameter Structure for Floating Point FFT</span></a></p>
<a class="reference internal image-reference" href="../_images/3-2d_fft_blk_dia.jpg"><img alt="doc tool flow" class="align-center" src="../_images/3-2d_fft_blk_dia.jpg" style="width: 60%;" /></a>
</div>
<div class="section" id="supported-data-types">
<h2>Supported Data Types<a class="headerlink" href="#supported-data-types" title="Permalink to this headline">¶</a></h2>
<p>2-d FFT currently supports complex&lt;float&gt; type for simulation and synthesis
only complex&lt;float&gt; is tested and verified to work. Also currently XF FFT library does’t supports
standard std::complex&lt;float&gt; instead a complex_wrapper class ships with XF FFT library that
can be used for simulation and synthesis.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 32%" />
<col style="width: 33%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Supported for Synthesis</p></th>
<th class="head"><p>Supported for Simulation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>complex_wrapper&lt;float&gt;</p></td>
<td><p>YES</p></td>
<td><p>YES</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="l1-api-for-2-d-fft">
<span id="d-fft-template-params-label"></span><h2>L1 API for 2-D FFT<a class="headerlink" href="#l1-api-for-2-d-fft" title="Permalink to this headline">¶</a></h2>
<p>2-D FFT is provided as a template function given below:</p>
<pre class="highlight literal-block"><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t_memWidth</span><span class="p">,</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t_numRows</span><span class="p">,</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t_numCols</span><span class="p">,</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t_numKernels</span><span class="p">,</span>
        <span class="k">typename</span> <span class="n">t_ssrFFTParamsRowProc</span><span class="p">,</span>
        <span class="k">typename</span> <span class="n">t_ssrFFTParamsColProc</span><span class="p">,</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t_rowInstanceIDOffset</span><span class="p">,</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">t_colInstanceIDOffset</span><span class="p">,</span>
        <span class="k">typename</span> <span class="n">T_elemType</span> <span class="c1">// complex element type</span>
        <span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">fft2d</span><span class="p">(</span><span class="n">hls</span><span class="o">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">WideInputType</span><span class="o">&gt;</span> <span class="p">,</span> <span class="n">hls</span><span class="o">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">WideOutputType</span><span class="o">&gt;</span><span class="p">);</span></pre>
<div class="section" id="template-parameters">
<h3>Template Parameters<a class="headerlink" href="#template-parameters" title="Permalink to this headline">¶</a></h3>
<p>fft2d is the top level L1 API provided which takes number of template parameters and in/out streams. These template
functions describe the architecture and the data-path of 1-D FFT processors deployed as line processors. The
description of these parameters is as follows:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Template Parameter</p></th>
<th class="head"><p>Functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>t_memWidth</p></td>
<td><p>Describes the width of wide stream in complex&lt;T_elemType&gt; words</p></td>
</tr>
<tr class="row-odd"><td><p>t_numRows</p></td>
<td><p>Number of rows in 2-D FFT input data (currently limited to 256)</p></td>
</tr>
<tr class="row-even"><td><p>t_numCols</p></td>
<td><p>Number of column in 2-D FFT input data (currently limited to 256)</p></td>
</tr>
<tr class="row-odd"><td><p>t_numKernels</p></td>
<td><p>Number of parallel kernels used to process rows/columns</p></td>
</tr>
<tr class="row-even"><td><p>t_ssrFFTParamsRowProc</p></td>
<td><p>Configuration parameter structure for row processors</p></td>
</tr>
<tr class="row-odd"><td><p>t_ssrFFTParamsColProc</p></td>
<td><p>Configuration parameter structure for column processors</p></td>
</tr>
<tr class="row-even"><td><p>t_rowInstanceIDOffset</p></td>
<td><p>Instance ID offset for row processors</p></td>
</tr>
<tr class="row-odd"><td><p>t_colInstanceIDOffset</p></td>
<td><p>Instance ID offset for column processors</p></td>
</tr>
<tr class="row-even"><td><p>T_elemType</p></td>
<td><p>The inner type for complex wrapper</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>t_memWidth:   Gives the width of wide stream in complex&lt;inner_type&gt; words can be calculated as: t_memWidth=(wide stream size in bits)/(sizeof(complex&lt;T_elemType&gt;)*8))</p></li>
<li><p>t_numRows:    2-D FFT processes a matrix the number of rows in input matrix are given by t_numRows</p></li>
<li><p>t_numCols:    2-D FFT processes a matrix the number of columns in input matrix are given by t_numCols</p></li>
<li><p>t_numKernels: 2dftt can deploy multiple 1-D FFT processors along rows and columns to processes numerous row/columns in parallel this paramter gives number of processors to be used along rows/columns. Number of columns used along rows and columns are same and equal t_numKernels</p></li>
<li><p>t_ssrFFTParamsRowProc: It is a structure of parameters that describes tranform direction, data-path etc for row processors. The details of configuration parameter structures can be found here <a class="reference internal" href="L1.html#float-fft-params-struct-label"><span class="std std-ref">Configuration Parameter Structure for Floating Point FFT</span></a> for fixed point case (currently not supported) it is <a class="reference internal" href="L1.html#fixed-fft-params-struct-label"><span class="std std-ref">Configuration Parameter Structure for Fixed Point FFT</span></a></p></li>
<li><p>t_ssrFFTParamsColProc: It is a structure of parameters that describes tranform direction, data-path etc for column processors. The details of configuration parameter structures can be found here <a class="reference internal" href="L1.html#float-fft-params-struct-label"><span class="std std-ref">Configuration Parameter Structure for Floating Point FFT</span></a> for fixed point case (currently not supported) it is <a class="reference internal" href="L1.html#fixed-fft-params-struct-label"><span class="std std-ref">Configuration Parameter Structure for Fixed Point FFT</span></a></p></li>
<li><p>t_rowInstanceIDOffset: 2-D FFT deploys multiple 1D FFT processors and it is required that every 1D FFT proessor has a unique ID. If ‘M’ processors are used along rows then their IDs will be in the range: (t_rowInstanceIDOffset+1 , t_rowInstanceIDOffset+M) the selection of offset for rows and columns should be made such that these ranges are unique without any overlap. Essentially it requires that <strong>abs(t_rowInstanceIDOffset - t_colInstanceIDOffset) &gt; M</strong></p></li>
<li><p>t_colInstanceIDOffset: 2-D FFT deploys multiple 1D FFT processors and it is required that every 1D FFT proessor has a unique ID. If ‘M’ processors are used along rows then their IDs will be in the range: (t_rowInstanceIDOffset+1 , t_rowInstanceIDOffset+M) the selection of offset for rows and columns should be made such that these ranges are unique without any overlap. Essentially it requires that <strong>abs(t_rowInstanceIDOffset - t_colInstanceIDOffset) &gt; M</strong></p></li>
<li><p>T_elemType: 2-D FFT processes complex samples and T_elemType gives the inner type used to store real and imaginary parts. Currently it supports only float as inner type for simulation and synthesis.</p></li>
</ul>
</div>
<div class="section" id="constraints-on-the-choice-of-template-parameters">
<h3>Constraints on the Choice of Template Parameters<a class="headerlink" href="#constraints-on-the-choice-of-template-parameters" title="Permalink to this headline">¶</a></h3>
<p>Currently the template paramters for 2-D FFT should follow the constraints liste below :</p>
<p>1- The radix <code class="docutils literal notranslate"><span class="pre">R</span></code> specified for both the row and column processors in <code class="docutils literal notranslate"><span class="pre">t_ssrFFTParamsRowProc</span></code> and <code class="docutils literal notranslate"><span class="pre">t_ssrFFTParamsColProc</span></code> should be same</p>
<p>2- The possible radix values are  : 2,4,8,16</p>
<p>3- The input data should be a square matrix i.e. <code class="docutils literal notranslate"><span class="pre">t_numRows==t_numCols</span></code></p>
<p>4- t_rowInstanceIDOffset and t_colInstanceIDOffset should be different and <code class="docutils literal notranslate"><span class="pre">abs(t_rowInstanceIDOffset</span> <span class="pre">-</span> <span class="pre">t_colInstanceIDOffset)</span> <span class="pre">&gt;</span> <span class="pre">t_numKernels</span></code></p>
<p>5- The selection of radix <code class="docutils literal notranslate"><span class="pre">R</span></code> , <code class="docutils literal notranslate"><span class="pre">t_numKernels</span></code> and <code class="docutils literal notranslate"><span class="pre">t_memWidth</span></code> should satisfy : <code class="docutils literal notranslate"><span class="pre">R*t_numKernels==t_memWidth</span></code>. This constraint essentially highlights the fact that number of kernels used should be enough not more nor less to exhaust input bandwidth.
6- <code class="docutils literal notranslate"><span class="pre">t_memWidth</span></code> should be multiple of sizeof(complex&lt;float&gt;)</p>
</div>
</div>
<div class="section" id="library-usage">
<h2>Library Usage<a class="headerlink" href="#library-usage" title="Permalink to this headline">¶</a></h2>
<p>This section will provide information about how to use 2-D FFT in your project.</p>
<div class="section" id="fixed-point-2-d-fft-l1-module-usage">
<h3>Fixed Point 2-D FFT L1 Module Usage<a class="headerlink" href="#fixed-point-2-d-fft-l1-module-usage" title="Permalink to this headline">¶</a></h3>
<p>Current version of the 2-D FFT doesn’t supports complex fixed type. Future releases may provide it.</p>
</div>
<div class="section" id="floating-point-2-d-fft-l1-module-usage">
<h3>Floating Point 2-D FFT L1 Module Usage<a class="headerlink" href="#floating-point-2-d-fft-l1-module-usage" title="Permalink to this headline">¶</a></h3>
<p>To use the XF 2-D FFT L1 module in a C++ HLS design:</p>
<p>1- Clone the XF FFT Library git repository and add the following path to compiler include path:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">REPO_PATH/xf_fft/L1/include/hw/xf_fft/float/</span></code></p>
</div></blockquote>
<p>2- Include <code class="docutils literal notranslate"><span class="pre">xf_fft.hpp</span></code></p>
<p>3- Use namespace <code class="docutils literal notranslate"><span class="pre">xf::dsp::fft</span></code></p>
<p>4- Define parameter structures for 1-D FFT processors used along rows and columns lets say call them <code class="docutils literal notranslate"><span class="pre">params_row</span></code> and <code class="docutils literal notranslate"><span class="pre">parms_column</span></code> by extending <code class="docutils literal notranslate"><span class="pre">ssr_fft_default_params</span></code> like <a class="reference internal" href="L1.html#float-fft-params-struct-label"><span class="std std-ref">Defining 1-D FFT Parameter Structure</span></a></p>
<p>5- call <code class="docutils literal notranslate"><span class="pre">fft2d&lt;8,</span> <span class="pre">16,</span> <span class="pre">16,</span> <span class="pre">2,</span> <span class="pre">params_row,</span> <span class="pre">params_column,</span> <span class="pre">0,3,</span> <span class="pre">complex_wrapper&lt;float&gt;</span> <span class="pre">&gt;(p_inStream,</span> <span class="pre">p_outStream);</span></code> description for template parameters can be found in <a class="reference internal" href="#d-fft-template-params-label"><span class="std std-ref">2-D FFT Template Parameters</span></a></p>
<p>Following section gives usage examples and explains some other interface level details for use in C++ based
HLS design.
To use the 2-D FFT L1 library:</p>
<ol class="arabic simple">
<li><p>Include the <code class="docutils literal notranslate"><span class="pre">xf_fft.hpp</span></code> header:</p></li>
</ol>
<pre class="highlight literal-block"><span></span><span class="cp">#include</span> <span class="cpf">&quot;xf_fft.hpp.h&quot;</span></pre>
<ol class="arabic simple" start="2">
<li><p>Use namespace <code class="docutils literal notranslate"><span class="pre">xf::dsp::fft</span></code></p></li>
</ol>
<pre class="highlight literal-block"><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">xf</span><span class="o">::</span><span class="n">dsp</span><span class="o">::</span><span class="n">fft</span><span class="p">;</span></pre>
<ol class="arabic simple" start="3">
<li><p>Define two C++ structure that extends ssr_fft_default_params, one for row and one for column processors:</p></li>
</ol>
<pre class="highlight literal-block"><span></span><span class="k">struct</span> <span class="nl">params_row</span><span class="p">:</span><span class="n">ssr_fft_default_params</span>
<span class="p">{</span>
   <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">R</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="n">fft_output_order_enum</span> <span class="n">output_data_order</span> <span class="o">=</span> <span class="n">SSR_FFT_NATURAL</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="n">transform_direction_enum</span> <span class="n">transform_direction</span> <span class="o">=</span> <span class="n">FORWARD_TRANSFORM</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nl">params_column</span><span class="p">:</span><span class="n">ssr_fft_default_params</span>
<span class="p">{</span>
   <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">R</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="n">fft_output_order_enum</span> <span class="n">output_data_order</span> <span class="o">=</span> <span class="n">SSR_FFT_NATURAL</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="n">transform_direction_enum</span> <span class="n">transform_direction</span> <span class="o">=</span> <span class="n">FORWARD_TRANSFORM</span><span class="p">;</span>
<span class="p">};</span></pre>
<ol class="arabic simple" start="4">
<li><p>Call 2-D FFT L1 module as follows:</p></li>
</ol>
<pre class="highlight literal-block"><span></span><span class="n">fft2d</span><span class="o">&lt;</span>
      <span class="mi">8</span><span class="p">,</span>
      <span class="mi">16</span><span class="p">,</span>
      <span class="mi">16</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">,</span>
      <span class="n">params_row</span><span class="p">,</span>
      <span class="n">params_col</span><span class="p">,</span>
      <span class="mi">0</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">,</span>
      <span class="n">complex_wrapper</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span>
     <span class="o">&gt;</span><span class="p">(</span><span class="n">p_inStream</span><span class="p">,</span> <span class="n">p_outStream</span><span class="p">);</span></pre>
</div>
<div class="section" id="complete-example-test">
<h3>Complete Example Test<a class="headerlink" href="#complete-example-test" title="Permalink to this headline">¶</a></h3>
<p>Following section lists a complete example test that uses 2-D FFT L1 module. The header file listed
below provides definition of most of the template parameters and data types used in test and also
the top level function <code class="docutils literal notranslate"><span class="pre">top_fft2d</span></code> that will be synthesized.</p>
<pre class="highlight literal-block"><span></span><span class="cp">#ifndef _TOP_2D_FFT_TEST_H_</span>
<span class="cp">#define _TOP_2D_FFT_TEST_H_</span>
<span class="cp">#ifndef __SYNTHESIS__</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#include</span> <span class="cpf">&quot;xf_fft.hpp&quot;</span><span class="cp"></span>

<span class="cp">#ifndef __SYNTHESIS__</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">xf</span><span class="o">::</span><span class="n">dsp</span><span class="o">::</span><span class="n">fft</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">float</span> <span class="n">T_innerData</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">complex_wrapper</span><span class="o">&lt;</span><span class="n">T_innerData</span><span class="o">&gt;</span> <span class="n">T_elemType</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_memWidthBits</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_memWidth</span> <span class="o">=</span> <span class="n">k_memWidthBits</span> <span class="o">/</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">complex_wrapper</span><span class="o">&lt;</span><span class="n">T_innerData</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_fftKernelRadix</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_numOfKernels</span> <span class="o">=</span> <span class="n">k_memWidth</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_fftKernelRadix</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_fftKernelSize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">float</span> <span class="n">T_innerFloat</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">complex_wrapper</span><span class="o">&lt;</span><span class="n">T_innerFloat</span><span class="o">&gt;</span> <span class="n">T_compleFloat</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_numRows</span> <span class="o">=</span> <span class="n">k_fftKernelSize</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_numCols</span> <span class="o">=</span> <span class="n">k_fftKernelSize</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_rowInstanceIDOffset</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_colInstanceIDOffset</span> <span class="o">=</span> <span class="mi">80000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">k_totalWideSamples</span> <span class="o">=</span> <span class="n">k_fftKernelSize</span> <span class="o">*</span> <span class="n">k_fftKernelSize</span> <span class="o">/</span> <span class="n">k_memWidth</span><span class="p">;</span>
<span class="k">struct</span> <span class="nl">FFTParams</span> <span class="p">:</span> <span class="n">ssr_fft_default_params</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="n">k_fftKernelSize</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">R</span> <span class="o">=</span> <span class="n">k_fftKernelRadix</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">transform_direction_enum</span> <span class="n">transform_direction</span> <span class="o">=</span> <span class="n">FORWARD_TRANSFORM</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">FFTParams2</span> <span class="p">:</span> <span class="n">ssr_fft_default_params</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="n">k_fftKernelSize</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">R</span> <span class="o">=</span> <span class="n">k_fftKernelRadix</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">transform_direction_enum</span> <span class="n">transform_direction</span> <span class="o">=</span> <span class="n">FORWARD_TRANSFORM</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">FFTIOTypes</span><span class="o">&lt;</span><span class="n">FFTParams</span><span class="p">,</span> <span class="n">T_elemType</span><span class="o">&gt;::</span><span class="n">T_outType</span> <span class="n">T_outType</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">WideTypeDefs</span><span class="o">&lt;</span><span class="n">k_memWidth</span><span class="p">,</span> <span class="n">T_elemType</span><span class="o">&gt;::</span><span class="n">WideIFType</span> <span class="n">MemWideIFTypeIn</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">WideTypeDefs</span><span class="o">&lt;</span><span class="n">k_memWidth</span><span class="p">,</span> <span class="n">T_elemType</span><span class="o">&gt;::</span><span class="n">WideIFStreamType</span> <span class="n">MemWideIFStreamTypeIn</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">WideTypeDefs</span><span class="o">&lt;</span><span class="n">k_memWidth</span><span class="p">,</span> <span class="n">T_outType</span><span class="o">&gt;::</span><span class="n">WideIFType</span> <span class="n">MemWideIFTypeOut</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">WideTypeDefs</span><span class="o">&lt;</span><span class="n">k_memWidth</span><span class="p">,</span> <span class="n">T_outType</span><span class="o">&gt;::</span><span class="n">WideIFStreamType</span> <span class="n">MemWideIFStreamTypeOut</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">top_fft2d</span><span class="p">(</span><span class="n">MemWideIFStreamTypeIn</span><span class="o">&amp;</span> <span class="n">p_inStream</span><span class="p">,</span> <span class="n">MemWideIFStreamTypeOut</span><span class="o">&amp;</span> <span class="n">p_outStream</span><span class="p">);</span>
<span class="cp">#endif</span></pre>
<p>Following <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> files defines top level function which essentially calls <code class="docutils literal notranslate"><span class="pre">fft2d</span></code> from XF FFT library.</p>
<pre class="highlight literal-block"><span></span><span class="cp">#include</span> <span class="cpf">&quot;top_2d_fft_test.hpp&quot;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">top_fft2d</span><span class="p">(</span><span class="n">MemWideIFStreamTypeIn</span><span class="o">&amp;</span> <span class="n">p_inStream</span><span class="p">,</span> <span class="n">MemWideIFStreamTypeOut</span><span class="o">&amp;</span> <span class="n">p_outStream</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#pragma HLS INLINE</span>
<span class="cp">#pragma HLS DATA_PACK variable = p_inStream</span>
<span class="cp">#pragma HLS DATA_PACK variable = p_outStream</span>
<span class="cp">#pragma HLS interface ap_ctrl_none port = return</span>

     <span class="n">fft2d</span><span class="o">&lt;</span>
         <span class="n">k_memWidth</span><span class="p">,</span>
         <span class="n">k_fftKernelSize</span><span class="p">,</span>
         <span class="n">k_fftKernelSize</span><span class="p">,</span>
         <span class="n">k_numOfKernels</span><span class="p">,</span>
         <span class="n">FFTParams</span><span class="p">,</span>
         <span class="n">FFTParams2</span><span class="p">,</span>
         <span class="n">k_rowInstanceIDOffset</span><span class="p">,</span>
         <span class="n">k_colInstanceIDOffset</span><span class="p">,</span>
         <span class="n">T_elemType</span>
        <span class="o">&gt;</span><span class="p">(</span><span class="n">p_inStream</span><span class="p">,</span> <span class="n">p_outStream</span><span class="p">);</span>
<span class="p">}</span></pre>
<p>The <code class="docutils literal notranslate"><span class="pre">main</span></code> function is defined as follows which runs an impulse test:</p>
<pre class="highlight literal-block"><span></span><span class="cp">#define TEST_2D_FFT_</span>
<span class="cp">#ifdef TEST_2D_FFT_</span>

<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;top_2d_fft_test.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;mVerificationUtlityFunctions.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xf_fft/hls_ssr_fft_2d_modeling_utilities.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;xf_fft.hpp&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 2d input matrix</span>
    <span class="n">T_elemType</span> <span class="n">l_inMat</span><span class="p">[</span><span class="n">k_fftKernelSize</span><span class="p">][</span><span class="n">k_fftKernelSize</span><span class="p">];</span>
    <span class="n">T_elemType</span> <span class="n">l_outMat</span><span class="p">[</span><span class="n">k_fftKernelSize</span><span class="p">][</span><span class="n">k_fftKernelSize</span><span class="p">];</span>
    <span class="n">T_elemType</span> <span class="n">l_data2d_golden</span><span class="p">[</span><span class="n">k_fftKernelSize</span><span class="p">][</span><span class="n">k_fftKernelSize</span><span class="p">];</span>

    <span class="c1">// init input matrix with complex impulse</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">k_fftKernelSize</span><span class="p">;</span> <span class="o">++</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">k_fftKernelSize</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">l_inMat</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_compleFloat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="n">l_inMat</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_compleFloat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Wide Stream for reading and streaming a 2-d matrix</span>
    <span class="n">MemWideIFStreamTypeIn</span> <span class="n">l_matToStream</span><span class="p">(</span><span class="s">&quot;matrixToStreaming&quot;</span><span class="p">);</span>
    <span class="n">MemWideIFStreamTypeOut</span> <span class="n">fftOutputStream</span><span class="p">(</span><span class="s">&quot;fftOutputStream&quot;</span><span class="p">);</span>
    <span class="c1">// Pass same data stream multiple times to measure the II correctly</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">runs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">runs</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">runs</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stream2DMatrix</span><span class="o">&lt;</span><span class="n">k_fftKernelSize</span><span class="p">,</span> <span class="n">k_fftKernelSize</span><span class="p">,</span> <span class="n">k_memWidth</span><span class="p">,</span> <span class="n">T_elemType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">l_inMat</span><span class="p">,</span> <span class="n">l_matToStream</span><span class="p">);</span>
        <span class="n">top_fft2d</span><span class="p">(</span><span class="n">l_matToStream</span><span class="p">,</span> <span class="n">fftOutputStream</span><span class="p">);</span>

        <span class="n">printMatStream</span><span class="o">&lt;</span><span class="n">k_fftKernelSize</span><span class="p">,</span> <span class="n">k_fftKernelSize</span><span class="p">,</span> <span class="n">k_memWidth</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fftOutputStream</span><span class="p">,</span> <span class="s">&quot;2D FFT Output Natural Order...&quot;</span><span class="p">);</span>
        <span class="n">streamToMatrix</span><span class="o">&lt;</span><span class="n">k_fftKernelSize</span><span class="p">,</span> <span class="n">k_fftKernelSize</span><span class="p">,</span> <span class="n">k_memWidth</span><span class="p">,</span> <span class="n">T_elemType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fftOutputStream</span><span class="p">,</span> <span class="n">l_outMat</span><span class="p">);</span>
    <span class="p">}</span> <span class="c1">// runs loop</span>

    <span class="n">T_elemType</span> <span class="n">golden_result</span> <span class="o">=</span> <span class="n">T_elemType</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">k_fftKernelSize</span><span class="p">;</span> <span class="o">++</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">k_fftKernelSize</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">golden_result</span> <span class="o">!=</span> <span class="n">l_outMat</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;================================================================&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;---------------------Impulse test Passed Successfully.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;================================================================&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span></pre>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="L1.html" class="btn btn-neutral" title="1-Dimensional (Line) FFT L1 FPGA Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Xilinx Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/target-highlight.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>