

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="keywords" content="Vitis, library, Database, Quantitative Finance, Vision, Data Compression, Security, Solver, BLAS, Hardware, xfOpenCV, xfdatabase, xffintech, xfcompression, xfsecurity, xfsolver, xfblas, xfhardware"/>
<meta name="description" content="Vitis software development platform includes an extensive set of open-source, performance-optimized libraries that offer out-of-the-box acceleration with minimal to zero-code changes to your existing applications, without the need to reimplement your algorithms from scratch to harness the benefits of Xilinx adaptive compute."/>
<meta name="xlnxdocumentclass" content="Document"> 
<meta name="xlnxdocumenttypes" content="Tutorials"> 
<!-- Header information provided by Emily-->
    <meta name="Language" content="en">
    <meta name="Location" content="us">
    <link rel="icon" type="image/vnd.microsoft.icon" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/favicon.ico">
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/favicon.ico">
  
  <title>Internals of Hash-Group-Aggregate (Generic Version) &mdash; Vitis Database Library v2019.2 documentation</title>
  
<!-- Header information provided by Emily-->
    <meta name="apple-itunes-app" content="app-id=1063287962">
    <meta name="google-play-app" content="app-id=com.marketing.xilinxgo">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://kit.fontawesome.com/d3dd8c60ed.js"></script>
    
    <link rel="stylesheet" href="https://www.xilinx.com/etc.clientlibs/clientlibs/granite/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/header-footer.min.css" type="text/css">
    <link rel="stylesheet" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all.min.css" type="text/css">
    
    <script type="text/javascript" src="https://www.xilinx.com/etc.clientlibs/clientlibs/granite/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.xilinx.com/etc.clientlibs/clientlibs/granite/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/header-footer.min.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css">
  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Internals of Hash-Join (Multi-Process-Unit Version)" href="../hash_join/hash_join_mpu.html" />
    <link rel="prev" title="Internals of Direct-Group-Aggregate" href="direct_group_aggr.html" /> 
</head>

<body class="wy-body-for-nav">
<div class="xilinx-bs3">
    <noindex>
        <header data-component="header">
            <nav class="navbar navbar-default">
                <div class="container main-nav">
                    <div class="row">
                        <div class="col-xs-5 col-sm-2 logo-column">
                            <div class="logo">
                                <a href="https://www.xilinx.com/">
                                    <img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc" />
                                </a>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-8 navbar-column">
                            <div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
                                <ul class="nav navbar-nav nav-justified">
                                    <li class="accordion-toggle-icons" data-component="toggle-dropdown">
                                        <a href="https://developer.xilinx.com/">
                                            Developers
                                        </a>
                                    </li>
                                    <li class="accordion-toggle-icons" data-component="toggle-dropdown">
                                        <a href="https://www.xilinx.com/support.html">
                                            Support
                                        </a>
                                    </li>
                                    <li class="accordion-toggle-icons" data-component="toggle-dropdown">
                                        <a href="https://forums.xilinx.com/">
                                            Forums
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="mini-nav col-sm-2">
                            <button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
                                <span></span>
                                <span></span>
                                <span></span>
                                <span></span>
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
    </noindex>
</div>
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis Database Library
          

          
          </a>

          
            
            
              <div class="version">
                2019.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#design-flows">Design Flows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#trademark-notice">Trademark Notice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release Note</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usecase.html">Typical Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../L1.html">L1 Module User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../hw_sql_guide.html">Primitive Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_api.html">Primitive APIs in <code class="docutils literal notranslate"><span class="pre">xf::database</span></code></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../internals.html">Primitive Design Internals</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../filter/dynamic_filter.html">Internals of Dynamic-Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eval/dynamic_eval.html">Internals of Dynamic-Evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash/hash.html">Internals of Lookup3 and Murmur3 Hash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bloom_filter/bloom_filter.html">Internals of Bloom-Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="group_aggr.html">Internals of Group-Aggregate (Using Sorted Rows)</a></li>
<li class="toctree-l3"><a class="reference internal" href="direct_group_aggr.html">Internals of Direct-Group-Aggregate</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Internals of Hash-Group-Aggregate (Generic Version)</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_join_mpu.html">Internals of Hash-Join (Multi-Process-Unit Version)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_join_v3.html">Internals of Hash-Join-v3 and Hash-Build-Probe-v3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_join_v4.html">Internals of Hash-Join-v4 and Hash-Build-Probe-v4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_semi_join.html">Internals of Hash-Semi-Join (Multi-Process-Unit Version)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_anti_join.html">Internals of Hash-Anti-Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_multi_join.html">Internals of Hash-Multi-Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../partition/partition.html">Internals of Hash-Partition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../non_hash_join/merge_join.html">Internals of Merge-Join and Merge-Left-Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../non_hash_join/nested_loop_join.html">Internals of Nested-Loop-Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combine_split/combine_split_unit.html">Internals of Combine-Split-Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sort/bitonic_sort.html">Internals of Bitonic Sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sort/insert_sort.html">Internals of Insert Sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sort/merge_sort.html">Internals of Merge Sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scan/scan_col.html">Internals of Scan</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../query_demo.html">Query-Specific Acceleration Demo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../gqe_guide/L2.html">L2 GQE Kernel User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gqe_guide/L3.html">L3 GQE Overlay User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark Result</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../benchmark/tpc_h.html">TPC-H Queries with GQE</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vitis Database Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../L1.html">L1 Module User Guide</a> &raquo;</li>
        
          <li><a href="../internals.html">Primitive Design Internals</a> &raquo;</li>
        
      <li>Internals of Hash-Group-Aggregate (Generic Version)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="internals-of-hash-group-aggregate-generic-version">
<span id="guide-hash-aggr-general"></span><h1>Internals of Hash-Group-Aggregate (Generic Version)<a class="headerlink" href="#internals-of-hash-group-aggregate-generic-version" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>This document describes the structure and execution of Hash-Aggr General Version,
implemented as <a class="reference internal" href="../hw_api.html#cid-xf-database-hashgroupaggregate"><span class="std std-ref">hashGroupAggregate</span></a> function.</p>
<img alt="Hash aggregate general module Structure" class="align-center" src="../../_images/hashGroupAggregate.png" />
<p>The Hash-Group-Aggregate (Generic Version) primitive is a primitive to accelerate Group-by algorithm.
It is designed to handle group aggregate with the capability of computing massive data within the utilization of high memory bandwidth.</p>
<p>This primitive can accept multiple input rows for key and payload on each cycle because of its multiple Processing Units (PUs).
The processing of multi-channel and multi-column is provided to work with scan module so that it could match the speed of DDR/HBM.
The input key and payload will be updated and stored in URAM. If hash overflow occurs, overflow key and payload will be sent to HBM which are exclusive for each PU.
When the kernel has finished one flow and there are still left keys which are not aggregated, the kernel will automatically scan the HBM again for the left keys and aggregate until all keys are aggregated.
A single PU will connect two HBM ports for a ping-pong process during different work round.
The max distinct of key aggregated in one work flow is stable, which is 2^(_WHashHight + _WHashLow). The maximum hash overflow should not exceed the storage size of the HBM.
The data should be aligned to little-end.</p>
<p>There are 6 runtime programmable functions for calculating the payload, which are:</p>
<ul class="simple">
<li>xf::database::AOP_MIN</li>
<li>xf::database::AOP_MAX</li>
<li>xf::database::AOP_SUM</li>
<li>xf::database::AOP_MEAN</li>
<li>xf::database::AOP_COUNT</li>
<li>xf::database::AOP_COUNTNONZERO</li>
</ul>
<p>The details of API description is shown in <a class="reference internal" href="../hw_api.html#cid-xf-database-hashgroupaggregate"><span class="std std-ref">hashGroupAggregate</span></a>. A minimal setup for <code class="docutils literal notranslate"><span class="pre">hashGroupAggregate</span></code> should be:</p>
<ul class="simple">
<li>WKey=8</li>
<li>KeyNM=1</li>
<li>WPay=8</li>
<li>PayNM=1</li>
<li>HashMode=1</li>
<li>WHashHigh=1</li>
<li>WHashLow=12</li>
<li>CHNM=1</li>
<li>WBuffer=32</li>
<li>BurstLenW=32</li>
<li>BurstLenR=32</li>
</ul>
<p>A maximal setup could be:</p>
<ul class="simple">
<li>WKey=64</li>
<li>KeyNM=8</li>
<li>WPay=64</li>
<li>PayNM=8</li>
<li>HashMode=1</li>
<li>WHashHigh=2</li>
<li>WHashLow=16</li>
<li>CHNM=4</li>
<li>WBuffer=512</li>
<li>BurstLenW=32</li>
<li>BurstLenR=32</li>
</ul>
<p>A recommended setup (tested in GQE kernel) should be:</p>
<ul class="simple">
<li>WKey=32</li>
<li>KeyNM=8</li>
<li>WPay=32</li>
<li>PayNM=8</li>
<li>HashMode=1</li>
<li>WHashHigh=2</li>
<li>WHashLow=17</li>
<li>CHNM=4</li>
<li>WBuffer=512</li>
<li>BurstLenW=32</li>
<li>BurstLenR=32</li>
</ul>
<p>For typical setup, the utilization in Vivado report on U280 card is:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="16%" />
<col width="20%" />
<col width="16%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>URAM</td>
<td>BRAM</td>
<td>LUT</td>
<td>Register</td>
<td>Freq</td>
<td>HBM ports</td>
</tr>
<tr class="row-even"><td>256</td>
<td>46</td>
<td>140000</td>
<td>190000</td>
<td>230M</td>
<td>8</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In the recommended setup, the primitive can process maximum of 4(channel) x 8(column) group key and 4(channel) x 8(column) payload per cycle, and the width of key and payload is 32.
It has 4 PU and takes 8 AXI ports as ping-pong buffer for processing hash overflow. It can perform &lt;sum/average/min/max/count/count_non_zero&gt; which controlled by runtime parameter.
For sum and average, the output have 64-bit (split into 32 high bit and 32 low bit) to avoid overflow in computing.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">hashGroupAggregate</span></code> primitive have multiple columns of input and output port for key and payload.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../hash_join/hash_join_mpu.html" class="btn btn-neutral float-right" title="Internals of Hash-Join (Multi-Process-Unit Version)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="direct_group_aggr.html" class="btn btn-neutral float-left" title="Internals of Direct-Group-Aggregate" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p>
        
        &copy; Copyright 2019, Xilinx

    </p>
  </div>
<!--
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 
-->
</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>