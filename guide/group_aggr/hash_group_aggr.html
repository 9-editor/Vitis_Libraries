

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Internals of Hash Group Aggregate (Generic Version) &mdash; XF Database Library 2.0 beta documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/xf-favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Internals of Hash-Join (Multi-Process-Unit Version)" href="../hash_join/hash_join_mpu.html" />
    <link rel="prev" title="Internals of Direct-Group-Aggregate" href="direct_group_aggr.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html#trademark-notice">Trademark Notice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release Note</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usecase.html">Typical Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../L1.html">L1 Module User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../hw_sql_guide.html">Primitive Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_api.html">Primitive APIs in <code class="docutils literal notranslate"><span class="pre">xf::database</span></code></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../internals.html">Primitive Design Internals</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../filter/dynamic_filter.html">Internals of Dynamic Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eval/dynamic_eval.html">Internals of Dynamic Evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="group_aggr.html">Internals of Group Aggregate (Using Sorted Rows)</a></li>
<li class="toctree-l3"><a class="reference internal" href="direct_group_aggr.html">Internals of Direct-Group-Aggregate</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Internals of Hash Group Aggregate (Generic Version)</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_join_mpu.html">Internals of Hash-Join (Multi-Process-Unit Version)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_semi_join.html">Implementation of Hash-Semi-Join (Multi-Process-Unit Version)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_join_v3.html">Internals of Hash-Join-v3 and Hash-Build-Probe-v3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hash_join/hash_join_v4.html">Internals of Hash-Join-v4 and Hash-Build-Probe-v4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../non_hash_join/merge_join.html">Internals of Merge-Join and Merge-Left-Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../non_hash_join/nested_loop_join.html">Internals of Nested-Loop-Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../combine_split/combine_split_unit.html">Internals of Combine-Split-Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sort/bitonic_sort.html">Internals of Bitonic Sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sort/insert_sort.html">Internals of Insert Sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sort/merge_sort.html">Internals of Merge Sort</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../query_demo.html">Query-Specific Acceleration Demo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../gqe_guide/L2.html">L2 GQE Kernel User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gqe_guide/L3.html">L3 GQE Overlay User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark Result</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../benchmark/tpc_h.html">TPC-H Queries with GQE</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">XF Database Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../L1.html">L1 Module User Guide</a> &raquo;</li>
        
          <li><a href="../internals.html">Primitive Design Internals</a> &raquo;</li>
        
      <li>Internals of Hash Group Aggregate (Generic Version)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="internals-of-hash-group-aggregate-generic-version">
<span id="guide-hash-aggr-general"></span><h1>Internals of Hash Group Aggregate (Generic Version)<a class="headerlink" href="#internals-of-hash-group-aggregate-generic-version" title="Permalink to this headline">Â¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>This document describes the structure and execution of Hash-Aggr General Version,
implemented as <a class="reference internal" href="../hw_api.html#cid-xf-database-hashgroupaggregate"><span class="std std-ref">hashGroupAggregate</span></a> function.</p>
<a class="reference internal image-reference" href="../../_images/hashGroupAggregate.png"><img alt="Hash aggregate general module Structure" class="align-center" src="../../_images/hashGroupAggregate.png" style="width: 100%;" /></a>
<p>The Hash-Group-Aggregate (Generic Version) primitive is a primitive to accerlerate Group-by algorithm. It is designed to handle aggregate with the capability of computing massive data within the storage Limit of FPGA DDR and to utilize the advantage of high memory bandwidth in Xilinx FPGA.</p>
<p>This primitive can accept multiple input rows for key and pld per cycle because of its multiple processing-unit(PU).
The processing of multi-channel and multi-column is provided to compat with the scan so that it could work at the speed of DDR/HBM.
When the kernel work one flow and there are left keys which are not aggregated,
the kernel automatically scan the HBM again for the left keys and aggregate until all keys are aggregated.
The max distinct of key aggregated in one work flow is stable, which is 2^(_WHashHight + _WHashLow).
The data should be aligned to the little-end.</p>
<p>Thera are 6 runtime programmable functions for calculating the payload which are: xf::database::AOP_MIN, xf::database::AOP_Max, xf::database::AOP_SUM, xf::database::AOP_MEAN, xf::database::AOP_COUNT and xf::database::AOP_COUNTNONZERO.</p>
<p>The detials of API description is ahown in <code class="docutils literal notranslate"><span class="pre">Primitive</span> <span class="pre">APIs</span> <span class="pre">in</span> <span class="pre">xf::database</span></code>
A minimal setup for <code class="docutils literal notranslate"><span class="pre">hashGroupAggregate</span></code> should be:
WKey=8, KeyNM=1, WPay=8, PayNM=1, HashMode=1, WHashHigh=1, WHashLow=12, CHNM=1, WBuffer=32, BurstLenW=32, BurstLenR=32</p>
<p>A maximum setup could be:
WKey=64, KeyNM=8, WPay=64, PayNM=8, HashMode=1, WHashHigh=2, WHashLow=16, CHNM=4, WBuffer=512, BurstLenW=32, BurstLenR=32,</p>
<p>A recommended setup (tested in GQE kernel) should be:
WKey=32, KeyNM=8, WPay=32, PayNM=8, HashMode=1, WHashHigh=2, WHashLow=17, CHNM=4, WBuffer=512, BurstLenW=32, BurstLenR=32
For typical setup, the utilization in Vivado report is: URAM:256, BRAM:46, LUT:140,000, Register:190,000, Freq:230MHz, Board:U280</p>
<p>In the recommended setup, the primitive can process maximum of 4(channel) x 8(column) group key and 4(channel) x 8(column) payload per cycle, and the width of key and payload is 32. It has 4 PU and  takes 8 AXI ports as ping-pong buffer for processing hash overflow. It can perform &lt;sum/average/min/max/count/count_non_zero&gt; which controlled by running parameter. For sum and average, the output have 64-bit (split into 32 high bit and 32 low bit) to avoid overflow in computing.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">hashGroupAggregate</span></code> primitve have multiple columns of input and output port for key and payload.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../hash_join/hash_join_mpu.html" class="btn btn-neutral float-right" title="Internals of Hash-Join (Multi-Process-Unit Version)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="direct_group_aggr.html" class="btn btn-neutral float-left" title="Internals of Direct-Group-Aggregate" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Xilinx Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>