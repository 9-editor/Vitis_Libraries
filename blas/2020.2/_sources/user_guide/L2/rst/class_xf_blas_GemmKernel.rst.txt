.. index:: pair: class; xf::blas::GemmKernel
.. _doxid-classxf_1_1blas_1_1_gemm_kernel:
.. _cid-xf::blas::gemmkernel:

template class xf::blas::GemmKernel
===================================

.. toctree::
	:hidden:

.. code-block:: cpp
	:class: overview-code-block

	#include "gemmKernel.hpp"


Overview
~~~~~~~~

:ref:`Gemm <doxid-classxf_1_1blas_1_1_gemm>` class, implement C = A*B+X t_aColMemWords defines number of memwords in the columns of one row of buffer_A. Due to the reusability, the height of buffer_A is only one memwords. For buffer_B, t_aColMemWords defines number of memwords in the rows of one column in buffer_B, t_bColMemWords defines number of memwords in the cols of one row in buffer_B. t_aRowMemWords and t_bColMemWords define the height and width of buffer_C in terms of memwords.



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - t_FloatType

        - matrix A, B entry data type

    *
        - t_XDataType

        - matrix X entry data type

    *
        - t_DdrWidth

        - number of matrix elements in one memory word

    *
        - t_XDdrWidth

        - number of matrix X elements in one memory word

    *
        - t_aColMemWords

        - number of memory words in one row of the matrix A buffer

    *
        - t_aRowMemWords

        - number of memory words in one column of the matrix A buffer

    *
        - t_bColMemWords

        - number of memory words in one row of the matrix B buffer

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1aac92e9c2cbaa4587fcb6e7aa9cab862d:
.. _cid-xf::blas::gemmkernel::ddrwidetype:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc:
.. _cid-xf::blas::gemmkernel::ddrinttype:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c:
.. _cid-xf::blas::gemmkernel::ddrstream:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a689d02489b63f083609869eeadf6cd60:
.. _cid-xf::blas::gemmkernel::taggedwidefloat:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a295d002c13db3ac95d88976aa1efa6d2:
.. _cid-xf::blas::gemmkernel::edgestream:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a61da9d6100fad87d24e7d62721265a7a:
.. _cid-xf::blas::gemmkernel::xddrwidetype:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a41e3e6fd4a8f3f00efb455c1b3da4cc3:
.. _cid-xf::blas::gemmkernel::xddrstream:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a1982a2fc3e049bb62fc143cd6e051360:
.. _cid-xf::blas::gemmkernel::ddrwidetypeforx:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a68a585a66ccb07ce2b1d4a1b217952fc:
.. _cid-xf::blas::gemmkernel::macbittype:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1af1694f44798535ccce35bd0b3c6b31d0:
.. _cid-xf::blas::gemmkernel::widemacbittype:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1af0dadff181e7ea392fac21c49d9ee562:
.. _cid-xf::blas::gemmkernel::widemacbitstream:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a08ac0f98e9145d91236da7f2fd9bacea:
.. _cid-xf::blas::gemmkernel::gemmargstype:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a12c80236d041d51886a5986b3ebc6d65:
.. _cid-xf::blas::gemmkernel::t_amh:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a63a4123d2eeb4e137410bb13cbcc4925:
.. _cid-xf::blas::gemmkernel::t_bkd:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a1aa9fa8ac9582e99552374be0a8eb2eb:
.. _cid-xf::blas::gemmkernel::t_ddroverxddr:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a273cf3f60009e2b3b140359be958bb10:
.. _cid-xf::blas::gemmkernel::t_xcolmemwords:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a0c0d2a613c00c4b391312d6b02c9da74:
.. _cid-xf::blas::gemmkernel::gemmcbuffer:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a5dc971ecd25ce6391b9053945c60df3b:
.. _cid-xf::blas::gemmkernel::gemmaddx:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a5c9f70d3b2861ecf39fa40acafc4f367:
.. _cid-xf::blas::gemmkernel::gemmblockstream:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1ad5d60b7fcdd5cfe2ce4030664886cd5b:
.. _cid-xf::blas::gemmkernel::gemmreadandmult:
.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a3b737bad41150814425e192b7e528152:
.. _cid-xf::blas::gemmkernel::gemmblocks:
.. ref-code-block:: cpp
	:class: overview-code-block

	template <
	    typename t_FloatType,
	    typename t_XDataType,
	    unsigned int t_DdrWidth,
	    unsigned int t_XDdrWidth,
	    unsigned int t_aColMemWords = 1,
	    unsigned int t_aRowMemWords = 1,
	    unsigned int t_bColMemWords = 1
	    >
	class GemmKernel

	// typedefs

	typedef WideType <t_FloatType, t_DdrWidth> DdrWideType
	typedef DdrWideType::t_TypeInt DdrIntType
	typedef hls::stream <:ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`> DdrStream
	typedef TaggedWideType <t_FloatType, t_DdrWidth> TaggedWideFloat
	typedef hls::stream <typename TaggedWideType <t_FloatType, t_DdrWidth>::t_TypeInt> EdgeStream
	typedef WideType <t_XDataType, t_XDdrWidth> XDdrWideType
	typedef hls::stream <typename WideType <t_XDataType, t_XDdrWidth>::t_TypeInt> XDdrStream
	typedef WideType <t_XDataType, t_DdrWidth> DdrWideTypeForX
	typedef t_FloatType MacBitType
	typedef :ref:`DdrWideType<doxid-classxf_1_1blas_1_1_gemm_kernel_1aac92e9c2cbaa4587fcb6e7aa9cab862d>` WideMacBitType
	typedef :ref:`DdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c>` WideMacBitStream
	typedef :ref:`GemmArgs<doxid-classxf_1_1blas_1_1_gemm_args>` GemmArgsType

	// fields

	static const unsigned int t_aMH
	static const unsigned int t_bKD
	static const unsigned int t_DdrOverXDdr
	static const unsigned int t_xColMemWords


Methods
~~~~~~~

.. FunctionSection

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a333dffe29dd2532328ad43dd3fa04ea3:
.. _cid-xf::blas::gemmkernel::gemmreadmata:

GemmReadMatA
------------


.. ref-code-block:: cpp
	:class: title-code-block

	void GemmReadMatA (
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_aAddr,
	    unsigned int l_aColBlocks,
	    unsigned int l_aRowBlocks,
	    unsigned int l_bColBlocks,
	    unsigned int l_aWordLd,
	    :ref:`DdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c>`& p_As
	    )

GemmReadMatA load data from Matrix A.



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - l_aAddr

        - the base address of matrix A in external memory

    *
        - l_aColBlocks

        - the No. blocks along matrix A cols

    *
        - l_aRowBlocks

        - the No. blocks along matrix A rows

    *
        - l_bColBlocks

        - the No. blocks along matrix B cols

    *
        - l_aWordLd

        - the matrix A word leading dimention

    *
        - p_As

        - the output stream

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1ac228d0508318a62611cda31fc34a1dd7:
.. _cid-xf::blas::gemmkernel::gemmreadmatb:

GemmReadMatB
------------


.. ref-code-block:: cpp
	:class: title-code-block

	void GemmReadMatB (
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_bAddr,
	    unsigned int l_aColBlocks,
	    unsigned int l_aRowBlocks,
	    unsigned int l_bColBlocks,
	    unsigned int l_bWordLd,
	    :ref:`DdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c>`& p_Bs
	    )

GemmReadMatB load data from matrix B.



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - l_bAddr

        - the base address of matrix B in external memory

    *
        - l_aColBlocks

        - the No. blocks along matrix B cols

    *
        - l_aRowBlocks

        - the No. blocks along matrix B rows

    *
        - l_bColBlocks

        - the No. blocks along matrix B cols

    *
        - l_bWordLd

        - the matrix B word leading dimention

    *
        - p_Bs

        - the output stream

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a60c6b8ecb7cb754d25e30526d747e215:
.. _cid-xf::blas::gemmkernel::gemmreadmatx:

GemmReadMatX
------------


.. ref-code-block:: cpp
	:class: title-code-block

	void GemmReadMatX (
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_xAddr,
	    unsigned int l_aColBlocks,
	    unsigned int l_aRowBlocks,
	    unsigned int l_bColBlocks,
	    unsigned int l_xWordLd,
	    :ref:`XDdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1a41e3e6fd4a8f3f00efb455c1b3da4cc3>`& p_Xs
	    )

GemmReadMatX load data from matrix X.



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - l_xAddr

        - the base address of matrix X in external memory

    *
        - l_aColBlocks

        - the No. blocks along matrix X cols

    *
        - l_aRowBlocks

        - the No. blocks along matrix X rows

    *
        - l_bColBlocks

        - the No. blocks along matrix X cols

    *
        - l_xWordLd

        - the matrix X word leading dimention

    *
        - p_Xs

        - the output stream

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1afa71e6fe6c37128cca49abf8359e5ad1:
.. _cid-xf::blas::gemmkernel::gemmreadabx:

GemmReadABX
-----------


.. ref-code-block:: cpp
	:class: title-code-block

	void GemmReadABX (
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_aAddr,
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_bAddr,
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_xAddr,
	    unsigned int l_aColBlocks,
	    unsigned int l_aRowBlocks,
	    unsigned int l_bColBlocks,
	    unsigned int l_aWordLd,
	    unsigned int l_bWordLd,
	    unsigned int l_xWordLd,
	    :ref:`DdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c>`& p_As,
	    :ref:`DdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c>`& p_Bs,
	    :ref:`XDdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1a41e3e6fd4a8f3f00efb455c1b3da4cc3>`& p_Xs
	    )

GemmReadABX load data from matrix A, B and X.



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - l_aAddr

        - the base address of matrix A in external memory

    *
        - l_bAddr

        - the base address of matrix B in external memory

    *
        - l_xAddr

        - the base address of matrix X in external memory

    *
        - l_aColBlocks

        - the No. blocks along matrix X cols

    *
        - l_aRowBlocks

        - the No. blocks along matrix X rows

    *
        - l_bColBlocks

        - the No. blocks along matrix X cols

    *
        - l_aWordLd

        - the matrix A word leading dimention

    *
        - l_bWordLd

        - the matrix B word leading dimention

    *
        - l_xWordLd

        - the matrix X word leading dimention

    *
        - p_As

        - the output stream for matrix A

    *
        - p_Bs

        - the output stream for matrix B

    *
        - p_Xs

        - the output stream for matrix X

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1aace2c1a6723b5fe63a6b73ebf5d0043a:
.. _cid-xf::blas::gemmkernel::rungemm:

runGemm
-------


.. ref-code-block:: cpp
	:class: title-code-block

	void runGemm (
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* p_DdrRd,
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* p_DdrWr,
	    :ref:`GemmArgsType<doxid-classxf_1_1blas_1_1_gemm_kernel_1a08ac0f98e9145d91236da7f2fd9bacea>`& p_Args
	    )

runGemm launch gemm operation with given arguments



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - p_DdrRd

        - the DDR/HBM address for input data

    *
        - p_DdrWr

        - the DDR/HBM address for output data

    *
        - p_Args

        - the arguments for gemm

.. _doxid-classxf_1_1blas_1_1_gemm_kernel_1a296bdad147a4447b2373f7373f4ad79b:
.. _cid-xf::blas::gemmkernel::gemmwriteddrstream:

GemmWriteDdrStream
------------------


.. ref-code-block:: cpp
	:class: title-code-block

	void GemmWriteDdrStream (
	    :ref:`DdrIntType<doxid-classxf_1_1blas_1_1_gemm_kernel_1adb7d544c73c45216a8657b991230aedc>`* l_cAddr,
	    :ref:`DdrStream<doxid-classxf_1_1blas_1_1_gemm_kernel_1aceea70dd0c6949bc49132c16bcaca62c>`& p_Cs,
	    unsigned int l_aRowBlocks,
	    unsigned int l_bColBlocks,
	    unsigned int l_cWordLd
	    )

GemmWriteDdrStream write matrix data to Memory.



.. rubric:: Parameters:

.. list-table::
    :widths: 20 80

    *
        - l_cAddr

        - the base address of matrix in external memory

    *
        - p_Cs

        - the input stream

    *
        - l_aRowBlocks

        - the No. blocks along matrix X rows

    *
        - l_bColBlocks

        - the No. blocks along matrix X cols

    *
        - l_cWordLd

        - the matrix word leading dimention

